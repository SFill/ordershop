version: '3'
services:
  billing-service:
    build: billing_service
    environment:
      - EVENT_STORE_HOST=event-store
      - MESSAGE_QUEUE_HOST=message-queue
    volumes:
      - ./billing_service:/app/billing_service
      - ./common:/app/common
      - logvolume01:/var/log
    links:
      - event-store
      - message-queue
  crm-service:
    build: crm_service
    environment:
      - EVENT_STORE_HOST=event-store
      - MESSAGE_QUEUE_HOST=message-queue
    volumes:
      - ./crm_service:/app/crm_service
      - ./common:/app/common
      - logvolume01:/var/log
    links:
      - event-store
      - message-queue
  customer-service:
    build: customer_service
    environment:
      - EVENT_STORE_HOST=event-store
      - MESSAGE_QUEUE_HOST=message-queue
    volumes:
      - ./customer_service:/app/customer_service
      - ./common:/app/common
      - logvolume01:/var/log
    links:
      - event-store
      - message-queue
  gateway-api:
    build: gateway_api
    environment:
      - EVENT_STORE_HOST=event-store
      - MESSAGE_QUEUE_HOST=message-queue
    ports:
      - "5000:5000"
    volumes:
      - ./gateway_api:/app/gateway_api
      - ./common:/app/common
      - logvolume01:/var/log
    links:
      - event-store
      - message-queue
    ulimits:
      nproc: 65535
      nofile: 65535
  inventory-service:
    build: inventory_service
    environment:
      - EVENT_STORE_HOST=event-store
      - MESSAGE_QUEUE_HOST=message-queue
    volumes:
      - ./inventory_service:/app/inventory_service
      - ./common:/app/common
      - logvolume01:/var/log
    links:
      - event-store
      - message-queue
  messaging-service:
    build: messaging_service
    environment:
      - EVENT_STORE_HOST=event-store
      - MESSAGE_QUEUE_HOST=message-queue
    volumes:
      - ./messaging_service:/app/messaging_service
      - ./common:/app/common
      - logvolume01:/var/log
    links:
      - message-queue
  order-service:
    build: order_service
    environment:
      - EVENT_STORE_HOST=event-store
      - MESSAGE_QUEUE_HOST=message-queue
    volumes:
      - ./order_service:/app/order_service
      - ./common:/app/common
      - logvolume01:/var/log
    links:
      - event-store
      - message-queue
  product-service:
    build: product_service
    environment:
      - EVENT_STORE_HOST=event-store
      - MESSAGE_QUEUE_HOST=message-queue
    volumes:
      - ./product_service:/app/product_service
      - ./common:/app/common
      - logvolume01:/var/log
    links:
      - event-store
      - message-queue
  event-store:
    build: event_store
    environment:
      - EVENT_STORE_REDIS_HOST=redis
      - EVENT_STORE_MAX_WORKERS=100
    volumes:
      - logvolume01:/var/log
    links:
      - redis
  message-queue:
    build: message_queue
    environment:
      - MESSAGE_QUEUE_REDIS_HOST=redis
      - MESSAGE_QUEUE_MAX_WORKERS=100
    volumes:
      - logvolume01:/var/log
    links:
      - redis
  redis:
    image: redis
    ports:
      - "6379:6379"
volumes:
  logvolume01: {}
#networks:
